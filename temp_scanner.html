<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Scanner - Kerala Lottery</title>
    <link href="output.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --scanner-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --winner-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --not-found-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --card-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --hover-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Enhanced modern styling */
        .enhanced-card {
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }
        
        .enhanced-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .winner-card {
            background: var(--winner-gradient);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .scanner-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .scanner-input {
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .scanner-result {
            min-height: 200px;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: white;
            box-shadow: var(--card-shadow);
        }
        
        .result-card {
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 25px;
            padding: 10px 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .lang-btn.active {
            background: var(--primary-gradient);
            color: white;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 25px;
            padding: 10px 20px;
            box-shadow: var(--card-shadow);
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        @media (max-width: 768px) {
            .scanner-container {
                padding: 10px;
            }
            
            .language-selector {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            .back-button {
                position: static;
                display: inline-block;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-100">
    <!-- Back Button -->
    <a href="index.html" class="back-button" id="backButton">â† Back to Home</a>
    
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="switchLanguage('en')">EN</button>
        <button class="lang-btn" onclick="switchLanguage('ml')">ML</button>
        <button class="lang-btn" onclick="switchLanguage('ta')">TA</button>
    </div>

    <div class="scanner-container">
        <h1 class="text-4xl font-bold text-center mb-8 text-gray-800" id="pageTitle">Lottery Scanner</h1>
        
        <!-- Scanner Input Section -->
        <div class="scanner-input">
            <h2 class="text-2xl font-bold mb-6 text-gray-700" id="inputTitle">Scan Your Ticket</h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-lg font-medium mb-2 text-gray-700" id="numberLabel">Ticket Number</label>
                    <input type="text" id="ticketNumber" placeholder="Enter ticket number (e.g., PM 162584)" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors">
                </div>
                
                <div>
                    <label class="block text-lg font-medium mb-2 text-gray-700" id="dateLabel">Draw Date</label>
                    <input type="date" id="drawDate" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors">
                </div>
                
                <button onclick="processManualInput()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-6 rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105 shadow-lg">
                    <span id="scanButton">Scan Ticket</span>
                </button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="scanner-result" id="scannerResults">
            <div class="text-gray-500" id="initialMessage">Enter your ticket details to check for winnings</div>
        </div>
    </div>

    <script>
        // UI Strings for different languages
        const langStrings = {
            en: {
                pageTitle: "Lottery Scanner",
                inputTitle: "Scan Your Ticket",
                numberLabel: "Ticket Number",
                dateLabel: "Draw Date",
                scanButton: "Scan Ticket",
                initialMessage: "Enter your ticket details to check for winnings",
                pleaseFill: "Please fill in all fields",
                winner: (count) => `ðŸŽ‰ YOU ARE A WINNER! Found ${count} winning entr${count === 1 ? 'y' : 'ies'}`,
                noWin: "ðŸ˜” No Winning Numbers Found",
                betterLuck: "Better luck next time!",
                sorry: (number, date) => `Sorry, your number "${number}" was not found in any winning results for ${date}.`,
                keepTrying: "Keep trying with other numbers or check back for new results!",
                prizeAmount: "Prize Amount:",
                number: "Number:",
                date: "Date:",
                viewFullResult: "View Full Result Page",
                backToHome: "Back to Home",
                congratulations: "Congratulations on your win!"
            },
            ml: {
                pageTitle: "à´²àµ‹à´Ÿàµà´Ÿà´±à´¿ à´¸àµà´•à´¾à´¨àµ¼",
                inputTitle: "à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´Ÿà´¿à´•àµà´•à´±àµà´±àµ à´ªà´°à´¿à´¶àµ‹à´§à´¿à´•àµà´•àµà´•",
                numberLabel: "à´Ÿà´¿à´•àµà´•à´±àµà´±àµ à´¨à´®àµà´ªàµ¼",
                dateLabel: "à´¡àµà´°àµ‹ à´¤àµ€à´¯à´¤à´¿",
                scanButton: "à´¸àµà´•à´¾àµ» à´Ÿà´¿à´•àµà´•à´±àµà´±àµ",
                initialMessage: "à´µà´¿à´œà´¯à´‚ à´¨àµ‡à´Ÿà´¿à´¯à´¿à´Ÿàµà´Ÿàµà´£àµà´Ÿàµ‹ à´Žà´¨àµà´¨àµ à´ªà´°à´¿à´¶àµ‹à´§à´¿à´•àµà´•à´¾àµ» à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´Ÿà´¿à´•àµà´•à´±àµà´±àµ à´µà´¿à´µà´°à´™àµà´™àµ¾ à´¨àµ½à´•àµà´•",
                pleaseFill: "à´Žà´²àµà´²à´¾ à´«àµ€àµ½à´¡àµà´•à´³àµà´‚ à´ªàµ‚à´°à´¿à´ªàµà´ªà´¿à´•àµà´•àµà´•",
                winner: (count) => `ðŸŽ‰ à´¨à´¿à´™àµà´™àµ¾ à´’à´°àµ à´µà´¿à´œà´¯à´¿à´¯à´¾à´£àµ! ${count} à´µà´¿à´œà´¯à´¿à´šàµà´š à´Žàµ»à´Ÿàµà´°à´¿à´•àµ¾ à´•à´£àµà´Ÿàµ†à´¤àµà´¤à´¿`,
                noWin: "ðŸ˜” à´µà´¿à´œà´¯à´¿à´šàµà´š à´¨à´®àµà´ªà´±àµà´•àµ¾ à´’à´¨àµà´¨àµà´‚ à´•à´£àµà´Ÿàµ†à´¤àµà´¤à´¿à´¯à´¿à´²àµà´²",
                betterLuck: "à´…à´Ÿàµà´¤àµà´¤ à´¤à´µà´£ à´•àµ‚à´Ÿàµà´¤àµ½ à´­à´¾à´—àµà´¯à´‚ à´‰à´£àµà´Ÿà´¾à´•à´Ÿàµà´Ÿàµ†!",
                sorry: (number, date) => `"${number}" à´Žà´¨àµà´¨ à´¨à´®àµà´ªàµ¼ ${date}-à´¨àµ à´µà´¿à´œà´¯à´¿à´šàµà´š à´«à´²à´™àµà´™à´³à´¿àµ½ à´•à´£àµà´Ÿàµ†à´¤àµà´¤à´¿à´¯à´¿à´²àµà´².`,
                keepTrying: "à´®à´±àµà´±àµ à´¨à´®àµà´ªà´±àµà´•àµ¾à´•àµà´•à´¾à´¯à´¿ à´¶àµà´°à´®à´¿à´•àµà´•àµà´• à´…à´²àµà´²àµ†à´™àµà´•à´¿àµ½ à´ªàµà´¤à´¿à´¯ à´«à´²à´™àµà´™àµ¾à´•àµà´•à´¾à´¯à´¿ à´ªà´°à´¿à´¶àµ‹à´§à´¿à´•àµà´•àµà´•!",
                prizeAmount: "à´¸à´®àµà´®à´¾à´¨ à´¤àµà´•:",
                number: "à´¨à´®àµà´ªàµ¼:",
                date: "à´¤àµ€à´¯à´¤à´¿:",
                viewFullResult: "à´ªàµ‚àµ¼à´£àµà´£ à´«à´²à´‚ à´•à´¾à´£àµà´•",
                backToHome: "à´¹àµ‹à´‚ à´ªàµ‡à´œà´¿à´²àµ‡à´•àµà´•àµ",
                congratulations: "à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´µà´¿à´œà´¯à´¤àµà´¤à´¿à´¨àµ à´…à´­à´¿à´¨à´¨àµà´¦à´¨à´™àµà´™àµ¾!"
            },
            ta: {
                pageTitle: "à®²à®¾à®Ÿà¯à®Ÿà®°à®¿ à®¸à¯à®•à¯‡à®©à®°à¯",
                inputTitle: "à®‰à®™à¯à®•à®³à¯ à®Ÿà®¿à®•à¯à®•à¯†à®Ÿà¯à®Ÿà¯ˆ à®šà®°à®¿à®ªà®¾à®°à¯à®•à¯à®•à®µà¯à®®à¯",
                numberLabel: "à®Ÿà®¿à®•à¯à®•à¯†à®Ÿà¯ à®Žà®£à¯",
                dateLabel: "à®•à¯‹à®²à¯ à®¤à¯‡à®¤à®¿",
                scanButton: "à®¸à¯à®•à¯‡à®©à¯ à®Ÿà®¿à®•à¯à®•à¯†à®Ÿà¯",
                initialMessage: "à®µà¯†à®±à¯à®±à®¿ à®ªà¯†à®±à¯à®±à®¿à®°à¯à®•à¯à®•à®¿à®±à®¤à®¾ à®Žà®©à¯à®ªà®¤à¯ˆà®šà¯ à®šà®°à®¿à®ªà®¾à®°à¯à®•à¯à®• à®‰à®™à¯à®•à®³à¯ à®Ÿà®¿à®•à¯à®•à¯†à®Ÿà¯ à®µà®¿à®µà®°à®™à¯à®•à®³à¯ˆ à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯",
                pleaseFill: "à®…à®©à¯ˆà®¤à¯à®¤à¯ à®ªà¯à®²à®™à¯à®•à®³à¯ˆà®¯à¯à®®à¯ à®¨à®¿à®°à®ªà¯à®ªà®µà¯à®®à¯",
                winner: (count) => `ðŸŽ‰ à®¨à¯€à®™à¯à®•à®³à¯ à®µà¯†à®©à¯à®±à¯à®³à¯à®³à¯€à®°à¯à®•à®³à¯! ${count} à®µà¯†à®±à¯à®±à®¿à®•à®³à¯ à®•à®£à¯à®Ÿà®±à®¿à®¯à®ªà¯à®ªà®Ÿà¯à®Ÿà¯à®³à¯à®³à®¤à¯`,
                noWin: "ðŸ˜” à®µà¯†à®©à¯à®± à®Žà®£à¯à®•à®³à¯ à®Žà®¤à¯à®µà¯à®®à¯ à®•à®£à¯à®Ÿà®±à®¿à®¯à®ªà¯à®ªà®Ÿà®µà®¿à®²à¯à®²à¯ˆ",
                betterLuck: "à®…à®Ÿà¯à®¤à¯à®¤ à®®à¯à®±à¯ˆ à®…à®¤à®¿à®• à®…à®¤à®¿à®°à¯à®·à¯à®Ÿà®®à¯!",
                sorry: (number, date) => `à®®à®©à¯à®©à®¿à®•à¯à®•à®µà¯à®®à¯, "${number}" à®Žà®©à¯à®± à®Žà®£à¯ ${date} à®…à®©à¯à®±à¯ à®µà¯†à®©à¯à®± à®®à¯à®Ÿà®¿à®µà¯à®•à®³à®¿à®²à¯ à®•à®¾à®£à®ªà¯à®ªà®Ÿà®µà®¿à®²à¯à®²à¯ˆ.`,
                keepTrying: "à®ªà®¿à®± à®Žà®£à¯à®•à®³à¯à®•à¯à®•à¯ à®®à¯à®¯à®±à¯à®šà®¿à®•à¯à®•à®µà¯à®®à¯ à®…à®²à¯à®²à®¤à¯ à®ªà¯à®¤à®¿à®¯ à®®à¯à®Ÿà®¿à®µà¯à®•à®³à¯à®•à¯à®•à®¾à®• à®šà®°à®¿à®ªà®¾à®°à¯à®•à¯à®•à®µà¯à®®à¯!",
                prizeAmount: "à®ªà®°à®¿à®šà¯ à®¤à¯Šà®•à¯ˆ:",
                number: "à®Žà®£à¯:",
                date: "à®¤à¯‡à®¤à®¿:",
                viewFullResult: "à®®à¯à®´à¯ à®®à¯à®Ÿà®¿à®µà¯ˆà®•à¯ à®•à®¾à®£à¯à®•",
                backToHome: "à®®à¯à®•à®ªà¯à®ªà®¿à®±à¯à®•à¯ à®šà¯†à®²à¯à®²à®µà¯à®®à¯",
                congratulations: "à®‰à®™à¯à®•à®³à¯ à®µà¯†à®±à¯à®±à®¿à®•à¯à®•à¯ à®µà®¾à®´à¯à®¤à¯à®¤à¯à®•à®³à¯!"
            }
        };

        // Global variables
        let currentLang = 'en';
        let historyData = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('drawDate').value = formattedDate;
            
            // Load history data
            loadHistoryData();
            
            // Set initial language
            updateUILanguage();
        });

        // Switch language
        function switchLanguage(lang) {
            currentLang = lang;
            updateUILanguage();
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Update UI language
        function updateUILanguage() {
            const t = langStrings[currentLang];
            
            document.getElementById('pageTitle').textContent = t.pageTitle;
            document.getElementById('inputTitle').textContent = t.inputTitle;
            document.getElementById('numberLabel').textContent = t.numberLabel;
            document.getElementById('dateLabel').textContent = t.dateLabel;
            document.getElementById('scanButton').textContent = t.scanButton;
            document.getElementById('initialMessage').textContent = t.initialMessage;
            document.getElementById('backButton').innerHTML = (currentLang === 'en' ? 'â† ' : '') + t.backToHome;
        }

        // Load history data
        async function loadHistoryData() {
            try {
                const response = await fetch('history.json');
                historyData = await response.json();
            } catch (error) {
                console.error('Error loading history data:', error);
            }
        }

        // Process manual input
        function processManualInput() {
            const t = langStrings[currentLang];
            const number = document.getElementById('ticketNumber').value.trim();
            const date = document.getElementById('drawDate').value;
            
            if (!number || !date) {
                alert(t.pleaseFill);
                return;
            }
            
            // Search in history.json
            const formattedDate = date.includes('-') ? date : date;
            const result = historyData.find(r => r.date === formattedDate || r.date === date);
            
            let found = null;
            let prizeInfo = null;
            let fileParam = '';
            
            if (result) {
                // Always set fileParam if result found
                if (result.lottery && result.draw && result.date) {
                    let dd, mm, yyyy;
                    if (result.date.includes('/')) {
                        [dd, mm, yyyy] = result.date.split('/');
                    } else if (result.date.includes('-')) {
                        [yyyy, mm, dd] = result.date.split('-');
                    }
                    let drawStr = String(result.draw).padStart(2, '0');
                    if (drawStr.startsWith(result.lottery + '-')) {
                        drawStr = drawStr.replace(result.lottery + '-', '');
                    }
                    if (result.lottery && drawStr && yyyy && mm && dd) {
                        fileParam = `${result.lottery}-${drawStr}-${yyyy}-${mm}-${dd}.json`;
                    } else {
                        fileParam = '';
                    }
                }
                
                // Normalize the search number for comparison
                const searchLower = number.replace(/\s+/g, '').toLowerCase();
                
                // Check all prizes using enhanced matching logic
                if (result.prizes && Array.isArray(result.prizes)) {
                    for (const prize of result.prizes) {
                        if (Array.isArray(prize.winners)) {
                            for (const winner of prize.winners) {
                                // Normalize the winner number for comparison
                                const numClean = winner.replace(/\s+/g, '').toLowerCase();
                                
                                // Enhanced matching logic to prevent overly broad matches
                                let isMatch = false;
                                
                                // Exact match - most precise
                                if (numClean === searchLower) {
                                    isMatch = true;
                                }
                                // Series number matching (e.g., "PM 162584" matching "PM 162584 (KOTTAYAM)")
                                else if (searchLower.length > 4 && numClean.startsWith(searchLower) && 
                                         numClean.length > searchLower.length) {
                                    // Check if the remaining part is location info in parentheses
                                    const remainder = numClean.substring(searchLower.length).trim();
                                    if (remainder.startsWith('(') && remainder.endsWith(')')) {
                                        isMatch = true;
                                    }
                                }
                                // For partial matches, be more restrictive:
                                // Only match if the search term is at the end of the number (common in lottery patterns)
                                else if (searchLower.length >= 4 && numClean.length > searchLower.length) {
                                    // Check if search term matches the end of the number (common in lottery patterns)
                                    if (numClean.endsWith(searchLower)) {
                                        isMatch = true;
                                    }
                                    // Special case for full ticket numbers like "PM 162584"
                                    else if (searchLower.includes(numClean) && Math.abs(searchLower.length - numClean.length) <= 3) {
                                        // Only match if the lengths are close (to avoid matching short numbers in long ones)
                                        isMatch = true;
                                    }
                                }
                                // Special case for lottery numbers - match last 6 digits exactly
                                else if (searchLower.length === 6 && numClean.length >= 6) {
                                    const numLast6 = numClean.slice(-6);
                                    if (searchLower === numLast6) {
                                        isMatch = true;
                                    }
                                }
                                
                                if (isMatch) {
                                    found = { number: number, date: result.date, status: 'winner', code: result.lottery, draw: result.draw, fileParam };
                                    prizeInfo = { label: prize.label, amount: prize.amount };
                                    break;
                                }
                            }
                        }
                        if (found) break;
                    }
                }
            }
            
            if (found) {
                found.prizeInfo = prizeInfo;
                displayScanResult(found);
            } else {
                displayScanResult({ number, date, status: 'no-win', prize: 'No Win', fileParam });
            }
        }

        // Display scan result
        function displayScanResult(result) {
            const t = langStrings[currentLang];
            const resultsContainer = document.getElementById('scannerResults');
            
            if (result.status === 'winner') {
                const resultHtml = `
                <div class="winner-card text-white p-6 text-center font-bold mb-6">
                    <div class="text-2xl mb-2">${t.winner(1)}</div>
                    <div class="text-lg">${t.congratulations}</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 w-full flex flex-col items-center border-2 border-green-200 result-card">
                    <div class="text-xl font-bold text-green-700 mb-3">${result.prizeInfo.label}</div>
                    <div class="mb-2"><span class="font-semibold text-gray-700">${t.number || 'Number:'}</span> <span class="text-gray-900 font-mono bg-gray-100 px-2 py-1 rounded">${result.number}</span></div>
                    <div class="mb-2"><span class="font-semibold text-gray-700">${t.prizeAmount || 'Prize Amount:'}</span> <span class="text-gray-900">${result.prizeInfo.amount}</span></div>
                    <div class="mb-4"><span class="font-semibold text-gray-700">${t.date || 'Date:'}</span> <span class="text-gray-900">${result.date}</span></div>
                    ${result.fileParam ? `<a href="result.html?file=${result.fileParam}" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">${t.viewFullResult || 'View Full Result Page'}</a>` : ''}
                </div>
                `;
                resultsContainer.innerHTML = resultHtml;
            } else {
                const resultHtml = `
                <div class="bg-gradient-to-r from-red-100 to-pink-100 rounded-xl p-8 text-center">
                    <div class="text-2xl font-bold text-red-700 mb-4">${t.noWin}</div>
                    <div class="text-lg text-red-600 mb-4">${t.betterLuck}</div>
                    <div class="text-gray-700 mb-4">${t.sorry(result.number, result.date)}</div>
                    <div class="text-gray-600">${t.keepTrying}</div>
                </div>
                `;
                resultsContainer.innerHTML = resultHtml;
            }
        }
    </script>
</body>
</html>
